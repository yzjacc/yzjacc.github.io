---
layout: post
title: "「Node」Node 登陆篇"
subtitle: " From Yuzj"
author: "Yuzj"
header-img: "img/post-bg-web.jpg"
header-mask: 0.3
catalog: true
tags:
- 后端
- NodeJS
---

### 1.Node操作Mysql

```js
//  dao层 dbutil.js
var mysql = require("mysql");

function createConnection() {
    var connection  = mysql.createConnection({
        host: "127.0.0.1",
        port: "3306",
        user: "root",
        password: "123456",
        database: "test"
    });
  	// 备注这种编码形式很不好 一个dao文件对应一个表的操作
    // var querySql = "select * from student"
    // connection.connect();
    //                                     // 结果和异常
    // connection.query(querySql, function(error,result){

    // })
    // connection.end();
    return connection;
}

module.exports.createConnection = createConnection
```

```js
// dao层 studentDao.js
var connection = require("./dbutil")

function queryAllStudent(success) {

    var querySql = "select * from student;";
    var connection = dbutil.createConnection(); // 每次请求都创建一个新的连接
    connection.connect();
    connection.query(querySql, function (error, result) {
        if (error == null) {
            console.log(result);
            success(result);
        } else {
            console.log(error);
        }

    });
    connection.end();
}

function queryStudentByClassAndAge(classNum, age) {

    var querySql = "select * from student where class = ? and age = ?;";
    var queryParams = [classNum, age];

    var connection = dbutil.createConnection();
    connection.connect();
 									 	 // sql语句 参数 回调函数
    connection.query(querySql, queryParams, function (error, result) {
        if (error == null) {
            console.log(result);
        } else {
            console.log(error);
        }

    });
    connection.end();
}
module.exports = {  "queryAllStudent": queryAllStudent,
                    "queryStudentByClassAndAge": queryStudentByClassAndAge
                 };

```

```js
// Service层 studentService.js
var studentDao = require("../dao/studentDao");

function queryAllStudent(success) {

    studentDao.queryAllStudent(success);

}

module.exports = {  "queryAllStudent": queryAllStudent,
                 };
```

```js
// web层 loginController.js
var studentService = require("../service/studentService");

var path = new Map();

function getData(request, response) {


    studentService.queryAllStudent(function (result) {
        var resArr = [];
        for (var i = 0 ; i < result.length ; i ++) {
            resArr.push(result[i].name);
        }
        response.write(resArr.toString());
        response.end();
    });

}
path.set("/getData", getData);
```

```js
// 浏览器层
window.onload = function() {

    // xmlHttp=new XMLHttpRequest();
    // xmlHttp.open("GET","/getData",true);
    // xmlHttp.send(null);
    //
    // xmlHttp.onreadystatechange=function () {
    //     if (xmlHttp.readyState ==4 && xmlHttp.status ==200){
    //         console.log(xmlHttp.responseText);
    //         console.log(typeof xmlHttp.responseText);
    //
    //     }
    // }

}
```

浏览器找web层 web层调服务层 服务层引dao dao调数据库

### 2.登陆基本流程